import{R as p,V as m,w as f,x as c,s as w,m as h,h as u,o as y,i as M}from"./three-CTi2GLhd.js";import{g as n}from"./gsap-C8pce-KX.js";import{B as D}from"./BaseExperience-u8VwpAi8.js";import{C as l}from"./index-BLRnMeqI.js";class E extends D{constructor(e,t,s){super(e,t,s),this.words=[],this.wordData=["I","have","always","loved","you"],this.correctOrder=[0,1,2,3,4],this.placedWords=[],this.targetLine=null,this.raycaster=new p,this.mouse=new m,this.selectedWord=null}getInstruction(){return"Arrange the words... speak from the heart"}getCompletionMessage(){return"Some words wait a lifetime<br>to be spoken."}async init(){this.createWords(),this.createTargetLine(),this.setupInteraction(),await super.init(),this.unsubscribeUpdate=this.sceneManager.onUpdate(this.update.bind(this))}createWords(){new(void 0)&&new(void 0),this.wordData.forEach((e,t)=>{const s=document.createElement("canvas"),o=s.getContext("2d");s.width=256,s.height=128,o.fillStyle="transparent",o.fillRect(0,0,s.width,s.height),o.font="italic 48px Cormorant Garamond, serif",o.fillStyle="#f1c27d",o.textAlign="center",o.textBaseline="middle",o.fillText(e,s.width/2,s.height/2);const i=new f(s);i.needsUpdate=!0;const d=new c({map:i,transparent:!0,side:w,depthWrite:!1}),r=new h(1.5,.75),a=new u(r,d);a.position.set((Math.random()-.5)*6,(Math.random()-.5)*4,(Math.random()-.5)*2),a.userData={index:t,word:e,floatOffset:Math.random()*Math.PI*2,isPlaced:!1,originalPos:a.position.clone()},this.words.push(a),this.group.add(a)})}createTargetLine(){const e=new h(1.4,.1),t=new c({color:l.champagneGold,transparent:!0,opacity:.2});this.slots=[];const s=-3;for(let o=0;o<5;o++){const i=new u(e,t.clone());i.position.set(s+o*1.5,-2,0),i.userData={slotIndex:o,occupied:!1},this.slots.push(i),this.group.add(i)}}setupInteraction(){this.boundMouseMove=this.onPointerMove.bind(this),this.boundMouseDown=this.onPointerDown.bind(this),this.boundMouseUp=this.onPointerUp.bind(this),window.addEventListener("mousemove",this.boundMouseMove),window.addEventListener("mousedown",this.boundMouseDown),window.addEventListener("mouseup",this.boundMouseUp),window.addEventListener("touchmove",this.boundMouseMove,{passive:!1}),window.addEventListener("touchstart",this.boundMouseDown,{passive:!1}),window.addEventListener("touchend",this.boundMouseUp,{passive:!1})}onPointerMove(e){e.type==="touchmove"&&e.preventDefault();const t=e.clientX||e.touches&&e.touches[0]&&e.touches[0].clientX,s=e.clientY||e.touches&&e.touches[0]&&e.touches[0].clientY;if(!(t===void 0||s===void 0)&&(this.mouse.x=t/window.innerWidth*2-1,this.mouse.y=-(s/window.innerHeight)*2+1,this.selectedWord)){const o=new y(this.mouse.x,this.mouse.y,0);o.unproject(this.sceneManager.camera);const i=o.sub(this.sceneManager.camera.position).normalize(),d=-this.sceneManager.camera.position.z/i.z,r=this.sceneManager.camera.position.clone().add(i.multiplyScalar(d));n.to(this.selectedWord.position,{x:r.x,y:r.y,duration:.1})}}onPointerDown(e){if(this.phase!=="interactive")return;e.type==="touchstart"&&e.preventDefault(),this.raycaster.setFromCamera(this.mouse,this.sceneManager.camera);const t=this.raycaster.intersectObjects(this.words);t.length>0&&!t[0].object.userData.isPlaced&&(this.selectedWord=t[0].object,n.to(this.selectedWord.scale,{x:1.2,y:1.2,duration:.2}))}onPointerUp(e){if(e&&e.type==="touchend"&&e.preventDefault(),!this.selectedWord)return;let t=null,s=1/0;this.slots.forEach(o=>{if(!o.userData.occupied){const i=this.selectedWord.position.distanceTo(o.position);i<s&&i<1.5&&(s=i,t=o)}}),t?this.placeWord(this.selectedWord,t):n.to(this.selectedWord.scale,{x:1,y:1,duration:.2}),this.selectedWord=null}placeWord(e,t){e.userData.isPlaced=!0,t.userData.occupied=!0,t.userData.wordIndex=e.userData.index,this.placedWords[t.userData.slotIndex]=e.userData.index,n.to(e.position,{x:t.position.x,y:t.position.y+.3,z:0,duration:.5,ease:"power3.out"}),n.to(e.scale,{x:1,y:1,duration:.3}),n.to(t.material,{opacity:.5,duration:.3}),this.words.filter(o=>o.userData.isPlaced).length>=5&&this.checkSentence()}checkSentence(){this.placedWords.every((t,s)=>t===this.correctOrder[s])?this.onConfessionComplete():this.resetWords()}resetWords(){this.words.forEach(e=>{e.userData.isPlaced=!1,n.to(e.position,{x:e.userData.originalPos.x,y:e.userData.originalPos.y,z:e.userData.originalPos.z,duration:.8})}),this.slots.forEach(e=>{e.userData.occupied=!1,n.to(e.material,{opacity:.2,duration:.3})}),this.placedWords=[]}async onConfessionComplete(){this.words.forEach((t,s)=>{n.to(t.material,{opacity:0,duration:1,delay:s*.2})});const e=new u(new M(.1,32,32),new c({color:l.roseRed,transparent:!0,opacity:.8}));e.position.set(0,-1.5,0),this.group.add(e),n.to(e.scale,{x:20,y:20,z:20,duration:2,ease:"power2.out"}),n.to(e.material,{opacity:0,duration:2,onComplete:()=>this.complete()})}update(e,t){this.isActive&&this.words.forEach(s=>{if(!s.userData.isPlaced&&s!==this.selectedWord){const o=s.userData.floatOffset;s.position.y=s.userData.originalPos.y+Math.sin(t+o)*.3,s.rotation.z=Math.sin(t*.5+o)*.1}})}dispose(){this.unsubscribeUpdate&&this.unsubscribeUpdate(),window.removeEventListener("mousemove",this.boundMouseMove),window.removeEventListener("mousedown",this.boundMouseDown),window.removeEventListener("mouseup",this.boundMouseUp),window.removeEventListener("touchmove",this.boundMouseMove),window.removeEventListener("touchstart",this.boundMouseDown),window.removeEventListener("touchend",this.boundMouseUp),super.dispose()}}export{E as default};
