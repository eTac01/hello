import{l as o,k as e,C as t,m as n,j as i,A as s,o as r,i as a,a as l,g as m}from"./index-DI5LSjs4.js";import{B as u}from"./BaseExperience-CpvtY6rA.js";class c extends u{constructor(o,e,t){super(o,e,t),this.comfortLevel=0,this.maxComfort=100}getInstruction(){return"Stay close... feel the comfort"}getCompletionMessage(){return"In stillness,<br>we find each other."}async init(){this.createComfortParticles(),this.createCenterGlow(),this.setupInteraction(),await super.init(),this.unsubscribeUpdate=this.sceneManager.onUpdate(this.update.bind(this))}createComfortParticles(){const a=300,l=new o,m=new Float32Array(900),u=new Float32Array(900),c=new Float32Array(a),h=new e(t.champagneGold),f=new e(t.roseRed);for(let o=0;o<a;o++){const e=Math.random()*Math.PI*2,t=Math.random()*Math.PI,n=3+2*Math.random();m[3*o]=n*Math.sin(t)*Math.cos(e),m[3*o+1]=n*Math.sin(t)*Math.sin(e),m[3*o+2]=n*Math.cos(t);const i=Math.random(),s=h.clone().lerp(f,i);u[3*o]=s.r,u[3*o+1]=s.g,u[3*o+2]=s.b,c[o]=3*Math.random()+1}l.setAttribute("position",new n(m,3)),l.setAttribute("color",new n(u,3)),l.setAttribute("size",new n(c,1)),this.originalPositions=m.slice();const v=new i({uniforms:{uTime:{value:0},uComfort:{value:0},uPixelRatio:{value:Math.min(window.devicePixelRatio,2)}},vertexShader:"\n        attribute float size;\n        attribute vec3 color;\n        varying vec3 vColor;\n        uniform float uTime;\n        uniform float uComfort;\n        uniform float uPixelRatio;\n        \n        void main() {\n          vColor = color;\n          \n          // Move toward center based on comfort\n          vec3 pos = position * (1.0 - uComfort * 0.7);\n          pos += vec3(\n            sin(uTime + position.x) * 0.1,\n            cos(uTime + position.y) * 0.1,\n            sin(uTime + position.z) * 0.1\n          );\n          \n          vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);\n          gl_PointSize = size * uPixelRatio * (100.0 / -mvPosition.z) * (1.0 + uComfort * 0.5);\n          gl_Position = projectionMatrix * mvPosition;\n        }\n      ",fragmentShader:"\n        varying vec3 vColor;\n        uniform float uComfort;\n        \n        void main() {\n          float dist = length(gl_PointCoord - vec2(0.5));\n          if (dist > 0.5) discard;\n          \n          float alpha = smoothstep(0.5, 0.0, dist) * (0.3 + uComfort * 0.7);\n          gl_FragColor = vec4(vColor, alpha);\n        }\n      ",transparent:!0,depthWrite:!1,blending:s,vertexColors:!0});this.particles=new r(l,v),this.group.add(this.particles)}createCenterGlow(){const o=new a(.3,32,32),n=new i({uniforms:{uTime:{value:0},uComfort:{value:0},uColor:{value:new e(t.champagneGold)}},vertexShader:"\n        varying vec3 vNormal;\n        void main() {\n          vNormal = normalize(normalMatrix * normal);\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        uniform float uTime;\n        uniform float uComfort;\n        uniform vec3 uColor;\n        varying vec3 vNormal;\n        \n        void main() {\n          float pulse = sin(uTime * 2.0) * 0.1 + 0.9;\n          float fresnel = pow(1.0 - abs(dot(vNormal, vec3(0.0, 0.0, 1.0))), 2.0);\n          float alpha = (0.2 + fresnel * 0.8) * uComfort * pulse;\n          gl_FragColor = vec4(uColor, alpha);\n        }\n      ",transparent:!0,blending:s});this.centerGlow=new l(o,n),this.group.add(this.centerGlow)}setupInteraction(){this.mousePos={x:0,y:0},this.boundMouseMove=o=>{this.mousePos.x=o.clientX/window.innerWidth*2-1,this.mousePos.y=-o.clientY/window.innerHeight*2+1},window.addEventListener("mousemove",this.boundMouseMove)}update(o,e){if(!this.isActive)return;const t=Math.sqrt(this.mousePos.x**2+this.mousePos.y**2);t<.5?this.comfortLevel+=20*o*(1-2*t):this.comfortLevel-=10*o,this.comfortLevel=Math.max(0,Math.min(this.maxComfort,this.comfortLevel));const n=this.comfortLevel/this.maxComfort;this.particles.material.uniforms.uTime.value=e,this.particles.material.uniforms.uComfort.value=n,this.centerGlow.material.uniforms.uTime.value=e,this.centerGlow.material.uniforms.uComfort.value=n;const i=1+2*n;this.centerGlow.scale.set(i,i,i),n>=1&&!this.isCompleted&&this.onComfortComplete()}async onComfortComplete(){m.to(this.particles.material.uniforms.uComfort,{value:1.2,duration:2,ease:"power2.out"}),m.to(this.centerGlow.scale,{x:10,y:10,z:10,duration:2,ease:"power2.out",onComplete:()=>this.complete()})}dispose(){this.unsubscribeUpdate&&this.unsubscribeUpdate(),window.removeEventListener("mousemove",this.boundMouseMove),super.dispose()}}export{c as default};
