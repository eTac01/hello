import{B as e,j as t,k as o,V as n,C as s,a as i,l as a,m as l,n as r,A as h,o as u,g as c}from"./index-DI5LSjs4.js";import{B as m}from"./BaseExperience-CpvtY6rA.js";class v extends m{constructor(e,t,o){super(e,t,o),this.chocolateMesh=null,this.heatLevel=0,this.maxHeat=100,this.heatRadius=2}getInstruction(){return"Bring warmth... let it melt"}getCompletionMessage(){return"Sweetness melts<br>into something beautiful."}async init(){this.createChocolate(),this.setupInteraction(),await super.init(),this.unsubscribeUpdate=this.sceneManager.onUpdate(this.update.bind(this))}createChocolate(){const a=new e(2,1.5,.5,32,32,8),l=new t({uniforms:{uTime:{value:0},uMelt:{value:0},uMousePos:{value:new n(0,0)},uColor1:{value:new o(4005642)},uColor2:{value:new o(9127187)},uGoldColor:{value:new o(s.champagneGold)}},vertexShader:"\n        uniform float uTime;\n        uniform float uMelt;\n        uniform vec2 uMousePos;\n        \n        varying vec2 vUv;\n        varying vec3 vPosition;\n        varying float vMeltAmount;\n        \n        void main() {\n          vUv = uv;\n          vPosition = position;\n          \n          vec3 pos = position;\n          \n          // Melt deformation\n          float dist = length(pos.xy - uMousePos * 2.0);\n          float meltInfluence = smoothstep(2.0, 0.0, dist) * uMelt;\n          vMeltAmount = meltInfluence;\n          \n          // Heart shape morphing as melt increases\n          if (uMelt > 0.5) {\n            float heartMorph = (uMelt - 0.5) * 2.0;\n            float angle = atan(pos.y, pos.x);\n            float r = length(pos.xy);\n            \n            // Heart polar equation approximation\n            float heartR = 0.8 * (1.0 - sin(angle)) * (1.0 + 0.3 * cos(2.0 * angle));\n            \n            pos.x = mix(pos.x, heartR * cos(angle) * 1.5, heartMorph * 0.5);\n            pos.y = mix(pos.y, heartR * sin(angle) * 1.5 + 0.5, heartMorph * 0.5);\n          }\n          \n          // Drip effect\n          pos.y -= meltInfluence * 0.3;\n          pos.z += sin(pos.x * 3.0 + uTime) * meltInfluence * 0.1;\n          \n          gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n        }\n      ",fragmentShader:"\n        uniform float uTime;\n        uniform float uMelt;\n        uniform vec3 uColor1;\n        uniform vec3 uColor2;\n        uniform vec3 uGoldColor;\n        \n        varying vec2 vUv;\n        varying vec3 vPosition;\n        varying float vMeltAmount;\n        \n        void main() {\n          // Base chocolate color with shine\n          vec3 color = mix(uColor1, uColor2, vUv.y + sin(vUv.x * 10.0) * 0.1);\n          \n          // Heat glow\n          color = mix(color, uGoldColor, vMeltAmount * 0.5);\n          \n          // Melted sheen\n          float shine = pow(max(0.0, dot(normalize(vec3(vUv - 0.5, 1.0)), vec3(0.0, 0.0, 1.0))), 8.0);\n          color += vec3(0.3) * shine * (0.5 + uMelt * 0.5);\n          \n          gl_FragColor = vec4(color, 1.0);\n        }\n      "});this.chocolateMesh=new i(a,l),this.chocolateMesh.position.set(0,0,0),this.group.add(this.chocolateMesh),this.createHeatParticles()}createHeatParticles(){const e=new a,t=new Float32Array(300),o=new Float32Array(300);for(let s=0;s<100;s++)t[3*s]=0,t[3*s+1]=0,t[3*s+2]=0,o[3*s]=.02*(Math.random()-.5),o[3*s+1]=.02*Math.random(),o[3*s+2]=.01*(Math.random()-.5);e.setAttribute("position",new l(t,3)),this.particleVelocities=o;const n=new r({color:s.champagneGold,size:.05,transparent:!0,opacity:0,blending:h});this.heatParticles=new u(e,n),this.group.add(this.heatParticles)}setupInteraction(){this.boundMouseMove=e=>{this.mousePos={x:e.clientX/window.innerWidth*2-1,y:-e.clientY/window.innerHeight*2+1}},window.addEventListener("mousemove",this.boundMouseMove)}update(e,t){if(!this.isActive||!this.chocolateMesh)return;const o=this.chocolateMesh.material;if(o.uniforms.uTime.value=t,this.mousePos){o.uniforms.uMousePos.value.set(this.mousePos.x,this.mousePos.y);const t=Math.sqrt(this.mousePos.x**2+this.mousePos.y**2);t<1?(this.heatLevel+=15*e*(1-t),this.heatParticles.material.opacity=Math.min(.8,this.heatLevel/50)):this.heatLevel-=5*e,this.heatLevel=Math.max(0,Math.min(this.maxHeat,this.heatLevel))}const n=this.heatLevel/this.maxHeat;if(o.uniforms.uMelt.value=n,this.heatParticles&&n>.1){const e=this.heatParticles.geometry.attributes.position.array;for(let t=0;t<e.length;t+=3)e[t]+=this.particleVelocities[t]*n,e[t+1]+=this.particleVelocities[t+1]*n,e[t+2]+=this.particleVelocities[t+2]*n,Math.abs(e[t])>2&&(e[t]=.5*(Math.random()-.5),e[t+1]=.5*(Math.random()-.5));this.heatParticles.geometry.attributes.position.needsUpdate=!0}n>=1&&!this.isCompleted&&this.onMeltComplete()}async onMeltComplete(){c.to(this.chocolateMesh.rotation,{y:2*Math.PI,duration:2,ease:"power2.inOut"}),c.to(this.heatParticles.material,{opacity:0,duration:1,onComplete:()=>this.complete()})}dispose(){this.unsubscribeUpdate&&this.unsubscribeUpdate(),window.removeEventListener("mousemove",this.boundMouseMove),super.dispose()}}export{v as default};
