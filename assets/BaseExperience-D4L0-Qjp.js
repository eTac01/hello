import{G as o}from"./three-BDTjZVi7.js";import{g as i}from"./gsap-C8pce-KX.js";import{T as n,t as r}from"./index-rAiMthE7.js";class l{constructor(t,e,s){this.dayIndex=t,this.sceneManager=e,this.onComplete=s,this.dayData=n[t],this.isActive=!1,this.isCompleted=!1,this.group=new o,this.ui=null,this.phase="intro"}async init(){this.sceneManager.scene.add(this.group),this.createUI(),this.isActive=!0,this.group.visible=!0,await this.playIntro(),this.phase="interactive",this.showInstruction()}createUI(){this.ui=document.createElement("div"),this.ui.className="experience-ui",this.ui.innerHTML=`
      <p class="instruction"></p>
    `,document.getElementById("ui-overlay").appendChild(this.ui),this.exitButton=document.createElement("button"),this.exitButton.className="exit-button",this.exitButton.textContent="Return",this.exitButton.addEventListener("click",()=>this.exit()),document.body.appendChild(this.exitButton),setTimeout(()=>{this.exitButton.classList.add("visible")},2e3)}showInstruction(){if(!this.ui)return;const t=this.ui.querySelector(".instruction");t&&(t.textContent=this.getInstruction(),i.to(t,{opacity:1,duration:1}))}getInstruction(){return"Experience the moment..."}async playIntro(){return new Promise(t=>{i.from(this.group.scale,{x:0,y:0,z:0,duration:1.5,ease:"power3.out",onComplete:t})})}async playOutro(){return new Promise(t=>{i.to(this.group,{opacity:0,duration:1.5,ease:"power3.inOut",onComplete:t})})}async complete(){this.isCompleted||(this.isCompleted=!0,this.phase="outro",r.markExperienceVisited(this.dayIndex),this.showCompletion(),await this.waitForContinue(),await this.playOutro(),this.onComplete&&this.onComplete(this.dayIndex))}showCompletion(){const t=document.createElement("div");t.className="completion-overlay",t.innerHTML=`
      <p class="message">${this.getCompletionMessage()}</p>
    `,document.body.appendChild(t),setTimeout(()=>{t.classList.add("visible")},100),this.completionOverlay=t}getCompletionMessage(){return"This moment is now part of you."}waitForContinue(){return new Promise(t=>{const e=()=>{window.removeEventListener("click",e),this.completionOverlay?i.to(this.completionOverlay,{opacity:0,duration:1,onComplete:()=>{this.completionOverlay.remove(),t()}}):t()};setTimeout(()=>{window.addEventListener("click",e)},2e3)})}exit(){this.isActive=!1,this.dispose(),this.onComplete&&this.onComplete(this.dayIndex,!0)}update(t,e){}onPointerMove(t,e){}onClick(t,e){}dispose(){this.isActive=!1,this.ui&&this.ui.parentNode&&this.ui.parentNode.removeChild(this.ui),this.exitButton&&this.exitButton.parentNode&&this.exitButton.parentNode.removeChild(this.exitButton),this.completionOverlay&&this.completionOverlay.parentNode&&this.completionOverlay.parentNode.removeChild(this.completionOverlay),this.group.traverse(t=>{t.geometry&&t.geometry.dispose(),t.material&&(Array.isArray(t.material)?t.material.forEach(e=>e.dispose()):t.material.dispose())}),this.group.parent&&this.sceneManager.scene.remove(this.group)}}export{l as B};
