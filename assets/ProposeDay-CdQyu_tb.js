import{R as e,V as t,e as s,f as o,D as i,P as n,a,C as r,h as d,g as c,i as h}from"./index-DI5LSjs4.js";import{B as u}from"./BaseExperience-CpvtY6rA.js";class l extends u{constructor(s,o,i){super(s,o,i),this.words=[],this.wordData=["I","have","always","loved","you"],this.correctOrder=[0,1,2,3,4],this.placedWords=[],this.targetLine=null,this.raycaster=new e,this.mouse=new t,this.selectedWord=null}getInstruction(){return"Arrange the words... speak from the heart"}getCompletionMessage(){return"Some words wait a lifetime<br>to be spoken."}async init(){this.createWords(),this.createTargetLine(),this.setupInteraction(),await super.init(),this.unsubscribeUpdate=this.sceneManager.onUpdate(this.update.bind(this))}createWords(){new(void 0)&&new(void 0),this.wordData.forEach((e,t)=>{const r=document.createElement("canvas"),d=r.getContext("2d");r.width=256,r.height=128,d.fillStyle="transparent",d.fillRect(0,0,r.width,r.height),d.font="italic 48px Cormorant Garamond, serif",d.fillStyle="#f1c27d",d.textAlign="center",d.textBaseline="middle",d.fillText(e,r.width/2,r.height/2);const c=new s(r);c.needsUpdate=!0;const h=new o({map:c,transparent:!0,side:i,depthWrite:!1}),u=new n(1.5,.75),l=new a(u,h);l.position.set(6*(Math.random()-.5),4*(Math.random()-.5),2*(Math.random()-.5)),l.userData={index:t,word:e,floatOffset:Math.random()*Math.PI*2,isPlaced:!1,originalPos:l.position.clone()},this.words.push(l),this.group.add(l)})}createTargetLine(){const e=new n(1.4,.1),t=new o({color:r.champagneGold,transparent:!0,opacity:.2});this.slots=[];for(let s=0;s<5;s++){const o=new a(e,t.clone());o.position.set(1.5*s-3,-2,0),o.userData={slotIndex:s,occupied:!1},this.slots.push(o),this.group.add(o)}}setupInteraction(){this.boundMouseMove=this.onPointerMove.bind(this),this.boundMouseDown=this.onPointerDown.bind(this),this.boundMouseUp=this.onPointerUp.bind(this),window.addEventListener("mousemove",this.boundMouseMove),window.addEventListener("mousedown",this.boundMouseDown),window.addEventListener("mouseup",this.boundMouseUp),window.addEventListener("touchmove",this.boundMouseMove,{passive:!1}),window.addEventListener("touchstart",this.boundMouseDown,{passive:!1}),window.addEventListener("touchend",this.boundMouseUp,{passive:!1})}onPointerMove(e){"touchmove"===e.type&&e.preventDefault();const t=e.clientX||e.touches&&e.touches[0]&&e.touches[0].clientX,s=e.clientY||e.touches&&e.touches[0]&&e.touches[0].clientY;if(void 0!==t&&void 0!==s&&(this.mouse.x=t/window.innerWidth*2-1,this.mouse.y=-s/window.innerHeight*2+1,this.selectedWord)){const e=new d(this.mouse.x,this.mouse.y,0);e.unproject(this.sceneManager.camera);const t=e.sub(this.sceneManager.camera.position).normalize(),s=-this.sceneManager.camera.position.z/t.z,o=this.sceneManager.camera.position.clone().add(t.multiplyScalar(s));c.to(this.selectedWord.position,{x:o.x,y:o.y,duration:.1})}}onPointerDown(e){if("interactive"!==this.phase)return;"touchstart"===e.type&&e.preventDefault(),this.raycaster.setFromCamera(this.mouse,this.sceneManager.camera);const t=this.raycaster.intersectObjects(this.words);t.length>0&&!t[0].object.userData.isPlaced&&(this.selectedWord=t[0].object,c.to(this.selectedWord.scale,{x:1.2,y:1.2,duration:.2}))}onPointerUp(e){if(e&&"touchend"===e.type&&e.preventDefault(),!this.selectedWord)return;let t=null,s=1/0;this.slots.forEach(e=>{if(!e.userData.occupied){const o=this.selectedWord.position.distanceTo(e.position);o<s&&o<1.5&&(s=o,t=e)}}),t?this.placeWord(this.selectedWord,t):c.to(this.selectedWord.scale,{x:1,y:1,duration:.2}),this.selectedWord=null}placeWord(e,t){e.userData.isPlaced=!0,t.userData.occupied=!0,t.userData.wordIndex=e.userData.index,this.placedWords[t.userData.slotIndex]=e.userData.index,c.to(e.position,{x:t.position.x,y:t.position.y+.3,z:0,duration:.5,ease:"power3.out"}),c.to(e.scale,{x:1,y:1,duration:.3}),c.to(t.material,{opacity:.5,duration:.3});this.words.filter(e=>e.userData.isPlaced).length>=5&&this.checkSentence()}checkSentence(){this.placedWords.every((e,t)=>e===this.correctOrder[t])?this.onConfessionComplete():this.resetWords()}resetWords(){this.words.forEach(e=>{e.userData.isPlaced=!1,c.to(e.position,{x:e.userData.originalPos.x,y:e.userData.originalPos.y,z:e.userData.originalPos.z,duration:.8})}),this.slots.forEach(e=>{e.userData.occupied=!1,c.to(e.material,{opacity:.2,duration:.3})}),this.placedWords=[]}async onConfessionComplete(){this.words.forEach((e,t)=>{c.to(e.material,{opacity:0,duration:1,delay:.2*t})});const e=new a(new h(.1,32,32),new o({color:r.roseRed,transparent:!0,opacity:.8}));e.position.set(0,-1.5,0),this.group.add(e),c.to(e.scale,{x:20,y:20,z:20,duration:2,ease:"power2.out"}),c.to(e.material,{opacity:0,duration:2,onComplete:()=>this.complete()})}update(e,t){this.isActive&&this.words.forEach(e=>{if(!e.userData.isPlaced&&e!==this.selectedWord){const s=e.userData.floatOffset;e.position.y=e.userData.originalPos.y+.3*Math.sin(t+s),e.rotation.z=.1*Math.sin(.5*t+s)}})}dispose(){this.unsubscribeUpdate&&this.unsubscribeUpdate(),window.removeEventListener("mousemove",this.boundMouseMove),window.removeEventListener("mousedown",this.boundMouseDown),window.removeEventListener("mouseup",this.boundMouseUp),window.removeEventListener("touchmove",this.boundMouseMove),window.removeEventListener("touchstart",this.boundMouseDown),window.removeEventListener("touchend",this.boundMouseUp),super.dispose()}}export{l as default};
